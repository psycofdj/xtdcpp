#!/bin/bash

set -e

# copying debug reports in release reports
for c_dir in $(find ${CI_WORK_DIR}/${CI_LSB_RELEASE}/debug/build/reports  -mindepth 1 -maxdepth 1 -type d); do
  l_name=$(basename ${c_dir})
  for c_report in $(find ${CI_WORK_DIR}/${CI_LSB_RELEASE}/debug/build/reports/${l_name}  -mindepth 1 -maxdepth 1 -type d); do
    l_report=$(basename ${c_report})
    rm -rf ${CI_WORK_DIR}/${CI_LSB_RELEASE}/release/build/reports/${l_name}/${l_report}
    cp -r ${CI_WORK_DIR}/${CI_LSB_RELEASE}/debug/build/reports/${l_name}/${l_report} ${CI_WORK_DIR}/${CI_LSB_RELEASE}/release/build/reports/${l_name}/${l_report}
  done
done

# updating release report interface
make -C ${CI_WORK_DIR}/${CI_LSB_RELEASE}/release/build reports-update

# copying reports into branch
rm -rf ${CI_WORK_DIR}/${CI_LSB_RELEASE}/reports
cp -r ${CI_WORK_DIR}/${CI_LSB_RELEASE}/release/build/reports ${CI_WORK_DIR}/${CI_LSB_RELEASE}/reports
